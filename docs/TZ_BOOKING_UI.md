# ТЗ: UI/UX экрана бронирования (3-шаговый Stepper)

## 0. Общий принцип

Пользователь бронирует **окно прибытия мастера** (arrival window) с шагом 30 минут.
Система показывает только доступные окна.

**3 шага:**
1. **Услуга** — что заказывает
2. **Мастер и время** — кто и когда приедет
3. **Оплата** — подтверждение и оплата

## 1. Stepper в шапке

```
[ ✓ Услуга ] → [ ● Мастер и время ] → [ ○ Оплата ]
```

**Состояния:**
- Done — галочка
- Active — подсветка
- Todo — серый

## 2. Шаг 1 — Услуга

### UI элементы:

```
┌─────────────────────────────────────┐
│ Вид массажа                         │
│ [Relax] [Thai] [...]                │
├─────────────────────────────────────┤
│ Сила                                │
│ [Soft] [Medium] [Hard] [Any]        │
├─────────────────────────────────────┤
│ Длительность (на человека)          │
│ [60 мин] [90 мин] [120 мин]         │
├─────────────────────────────────────┤
│ Количество людей                    │
│ [1] [2] [3] [4]                     │
├─────────────────────────────────────┤
│                          [Далее →]  │
└─────────────────────────────────────┘
```

### Результат:
```javascript
serviceParams = {
    massage_type: 'relax',
    pressure_level: 'medium',
    duration_per_person: 60,
    people_count: 1
}
```

## 3. Шаг 2 — Мастер и время (один экран)

### UI блоки:

**A) Сводка услуги**
```
┌─────────────────────────────────────┐
│ Relax • Medium • 60 мин • 1 чел    │
│                         [Изменить] │
└─────────────────────────────────────┘
```

**B) Карусель мастеров**
```
┌────────┐ ┌────────┐ ┌────────┐
│  👤    │ │  📷    │ │  📷    │
│  Все   │ │ Анвар  │ │ Бекзод │
│мастера │ │  ⭐4.9 │ │  ⭐4.8 │
│   ●    │ │   ○    │ │   ○    │
└────────┘ └────────┘ └────────┘
```

**C) Лента дат**
```
[Сегодня] [Завтра] [Пн 12] [Вт 13] [Ср 14] ...
```

**D) Слоты прибытия**
```
┌─────────┐ ┌─────────┐ ┌─────────┐
│ 10:00   │ │ 10:30   │ │ 11:00   │
│ 10:30   │ │ 11:00   │ │ 11:30   │
└─────────┘ └─────────┘ └─────────┘
┌─────────┐ ┌─────────┐
│ 11:30   │ │ 12:00   │
│ 12:00   │ │ 12:30   │
└─────────┘ └─────────┘
```

**E) Памятка**
```
┌─────────────────────────────────────┐
│ 📋 Перед визитом:                   │
│ • Тихая комната без прохода         │
│ • Место 2×2 м + розетка             │
│ • Сообщите противопоказания         │
└─────────────────────────────────────┘
```

**F) Sticky footer**
```
┌─────────────────────────────────────┐
│ Итого: 250,000 сўм    [Далее →]    │
└─────────────────────────────────────┘
```

### Логика:

**Режим "Все мастера":**
- Слоты = где есть хотя бы 1 подходящий мастер
- При выборе слота фильтруются мастера
- Если 1 мастер — авто-выбор

**Пересчёт при изменении:**
- massage_type / pressure_level / duration / people_count
- date
- therapist

## 4. Шаг 3 — Оплата

```
┌─────────────────────────────────────┐
│ 📋 Детали заказа                    │
├─────────────────────────────────────┤
│ Услуга: Relax, 60 мин              │
│ Мастер: Анвар                       │
│ Дата: 12 февраля, 10:00-10:30      │
│ Адрес: [указать]                    │
├─────────────────────────────────────┤
│ Итого: 250,000 сўм                  │
├─────────────────────────────────────┤
│ Способ оплаты:                      │
│ [Payme] [Click]                     │
├─────────────────────────────────────┤
│ ☐ Я принимаю условия оферты        │
├─────────────────────────────────────┤
│        [Оплатить] (неактивна)       │
└─────────────────────────────────────┘
```

**Правила:**
- Чекбокс оферты ОБЯЗАТЕЛЕН
- Кнопка активна только после чекбокса

## 5. State модель (для фронтенда)

```javascript
const state = {
    selectedStep: 1, // 1|2|3
    
    // Шаг 1
    serviceParams: {
        type: 'relax',
        pressure: 'medium',
        durationPerPerson: 60,
        peopleCount: 1
    },
    
    // Шаг 2
    selectedTherapistId: null, // null | 'all' | id
    selectedDate: null,
    selectedSlot: null, // { start, end }
    availableSlots: [],
    availableTherapists: [],
    
    // Шаг 3
    address: '',
    offerAccepted: false,
    paymentMethod: null // 'payme' | 'click'
};
```

## 6. API endpoints

```
GET /api/v1/slots?date=YYYY-MM-DD&serviceParams=...&therapistId=...
→ { slots: [], availableTherapistsCount: N }

GET /api/v1/therapists?date=YYYY-MM-DD&slot=HH:MM&serviceParams=...
→ { therapists: [] }

GET /api/v1/dates/availability?from=YYYY-MM-DD&to=YYYY-MM-DD&serviceParams=...
→ { dates: [{ date, hasSlots: bool }] }

POST /api/v1/bookings
→ { orderId, orderNumber, status }
```

## 7. Acceptance Criteria

1. ✅ На шаге 2 пользователь **никогда** не видит занятые слоты
2. ✅ Смена параметров пересчитывает доступность
3. ✅ "Все мастера" + слот → авто-выбор если 1 мастер
4. ✅ Оферта/чекбокс только на шаге 3
5. ✅ Без чекбокса оплатить нельзя
6. ✅ Памятка отображается на шаге 2
7. ✅ Итоговая сумма обновляется при смене параметров
