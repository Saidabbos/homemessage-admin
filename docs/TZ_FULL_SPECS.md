=== file_29---3f8f426b-e664-4dc9-9760-32a22d43b766.docx ===
“ТЗ: Механизм расчёта доступных слотов прибытия и бронирования времени мастера (выездной массаж)”Вводная: как работает механизм слотов прибытия и бронирования времени мастераЭтот модуль решает одну задачу: показать клиенту только те 30-минутные “окна прибытия”, в которые мастер реально может приехать и выполнить массаж, не сорвав следующие записи и не выходя за рамки смены.Клиент в приложении выбирает дату, мастера (или “Все”), длительность (60/90/120) и затем видит только свободные слоты прибытия (например, 10:00–10:30). При этом важно понимать: клиент бронирует не 30 минут, а полный “пакет занятости мастера”, который включает:Travel — дорога к клиенту (30 мин)Pre — подготовка на месте до массажа (10 мин)Massage — сама услуга (60/90/120)Post — сборы после массажа (10 мин)То есть слот 10:00–10:30 — это только “окно, когда мастер должен прибыть”, а система блокирует мастера на время 30+10+Massage+10 (110/140/170 минут) плюс дополнительно учитывает дорогу, чтобы успеть к следующему заказу.Чтобы расчёт был устойчивым и не ломался из-за опозданий внутри окна, система проверяет худший случай: предполагает, что мастер приедет в самый конец окна (arrival_latest = slot_end). Если даже при таком сценарии заказ “помещается” между предыдущим и следующим заказом мастера, значит слот действительно можно показать клиенту как доступный.В результате клиент:не видит занятые слотыне видит слоты, которые математически не помещаются (например, 120 минут уже не успевают до следующей записи)выбирает только те варианты, которые гарантированно выполнимы по времениДля прозрачности внутри админ/аналитики слоты маркируются тремя статусами:Поступил заказ — на этот 30-мин слот оформлен вызов (например, “Заказ 60 мин, ИТОГО 30+10+60+10=110”)Занят — мастер занят (Travel/Pre/Massage/Post)Свободен — мастер свободен; система должна показать, какие длительности можно вставить в этот слот (60/90/120), учитывая ограничения до следующего заказа/конца сменыДополнительно фиксируется, из чего именно состоят Pre и Post (10 минут до и 10 минут после), чтобы эти буферы были не “магией”, а понятными операционными действиями мастера (вход/гигиена/стол/материалы/опрос и т.п.; после — упаковка/антисептик/сборка/перезагрузка/выход).Итог: это не просто календарь, а scheduling engine, который переводит “красивые слоты для клиента” в “реально выполнимый тайминг для мастера” и гарантирует отсутствие накладок в графике.1) Цель и общий принципСистема должна показывать клиенту только доступные “слоты прибытия” (arrival windows) с шагом 30 минут (например, 10:00–10:30).При этом фактически бронируется не 30 минут, а полный интервал занятости мастера:Travel (дорога к клиенту)Pre (подготовка на месте до начала массажа)Massage (60/90/120)Post (сборы после массажа)Клиент не видит занятые слоты и не видит слоты, которые математически не помещаются между уже имеющимися заказами.2) Термины и параметры (обязательные сущности)2.1. Параметры (константы на уровне настройки системы)SLOT_STEP = 30 min — шаг слотов прибытияTRAVEL = 30 min — дорога (фиксированная в этой версии)PRE = 10 min — подготовка на местеPOST = 10 min — сборы на месте2.2. Входные данныеРабочий график мастера: shift_start, shift_endСписок заказов мастера orders[], каждый заказ хранит:arrival_window_start, arrival_window_end (например, 10:00–10:30)arrival_fact (если уже назначено/зафиксировано) — может быть null до подтвержденияmassage_duration (60/90/120)вычисляемые поля: service_start, service_end, busy_start, busy_end2.3. Что показываем пользователюПоказываем только:arrival_window_start–arrival_window_end (30-мин окно)список допустимых длительностей для этого окна: {60, 90, 120} (или только часть)3) Модель времени заказа (как блокируется мастер)3.1. Принцип “окно прибытия”Заказ оформляется на окно прибытия W = [Wstart, Wend] (30 минут).Мастер может приехать в любое время внутри окна.Для проверки доступности используем худший случай:arrival_latest = Wend (самый поздний приезд в этом окне)Это гарантирует, что даже если мастер приедет в самом конце окна, заказ всё равно не конфликтует.3.2. Блокировки для нового заказа (кандидата)Если клиент выбрал длительность D (60/90/120), тогда:service_start_latest = arrival_latest + PREservice_end_latest = service_start_latest + Dready_to_leave_latest = service_end_latest + POSTДля стыковки со следующим заказом добавляется ещё:must_leave_by = next_arrival_latest - TRAVELгде next_arrival_latest = next_window_endУсловие “успеваем до следующего заказа”:ready_to_leave_latest + TRAVEL &lt;= next_arrival_latestэквивалентно:arrival_latest + PRE + D + POST + TRAVEL &lt;= next_arrival_latest3.3. Условие “после предыдущего заказа”Если есть предыдущий заказ, то, чтобы успеть приехать в выбранное окно:prev_ready_to_leave + TRAVEL &lt;= arrival_latestгде:prev_ready_to_leave = prev_service_end + POST(в строгой версии можно тоже считать по prev_window_end, если факт прибытия не зафиксирован)Из чего состоит Pre и PostДо массажа (Pre) — 10 минутВход/ориентация + переобуться/быстро договориться где ставим стол — 3 минГигиена рук + подготовка места (простынь/пелёнка/пакет рядом) — 3 минРазложить стол/подголовник/валики — 2 минМатериалы (полотенце/масло/салфетки) + мини-опрос “что болит/какая сила” — 2 мин✅ Pre-buffer = 10 минутПосле массажа (Post) — 10 минутЗавершение (коротко) + 1 фраза рекомендаций — 1 минСвернуть материалы в пакет — 1 минПротирка/антисептик (руки/стол точечно) — 2 минСложить стол/упаковать — 3 минОтдых мастера (вода/перезагрузка) — 2 минВыход до машины — 1 мин✅ Post-buffer = 10 минут4) Алгоритм генерации доступных слотов (для разработчика)4.1. Генерация кандидатов (слоты прибытия)Для выбранного дня и мастера:Берём рабочее окно мастера: [shift_start, shift_end]Генерируем слоты по 30 минут:Wstart = shift_start округлить вверх до кратности 30 минутWend = Wstart + 30следующий слот: Wstart += 30Для каждого слота считаем, какие длительности {60,90,120} допустимы.4.2. Проверка длительности для слотаДля конкретного слота W=[Wstart,Wend] и длительности D:Шаг A — после предыдущего заказаНаходим ближайший заказ до этого слота (по времени), prev.Если prev существует:считаем prev_ready_to_leave = prev.service_end + POSTпроверяем: prev_ready_to_leave + TRAVEL &lt;= Wendесли нет — длительность D недоступна в этом слотеШаг B — до следующего заказаНаходим ближайший заказ после этого слота, next.Если next существует:next_arrival_latest = next.arrival_window_endпроверяем: Wend + PRE + D + POST + TRAVEL &lt;= next_arrival_latestесли нет — D недоступнаШаг C — в рамках сменыЕсли заказа после нет, проверяем только смену:Wend + PRE + D + POST &lt;= shift_end(Travel после последнего можно не учитывать, если не планируем дорогу “домой”)Если все проверки пройдены — показываем D как доступную длительность для слота W.5) Статусы слота в админ/аналитической таблицеДля внутреннего расписания полезны 3 статуса (как мы делали в таблице):Поступил заказ — слот, на который оформлен заказ (окно прибытия)Показывать текст:“Заказ — массаж D мин (ИТОГО: 30+10+D+10=…)”Занят — в этот интервал мастер занят (Travel/Pre/Massage/Post)Свободен — нет занятости, и система должна уметь показать список длительностей, которые можно принять6) Пример формулы “ИТОГО” для отображения в карточке заказаДля удобства поддержки:TOTAL_BUSY = TRAVEL + PRE + DURATION + POSTПримеры:60 → 30+10+60+10 = 11090 → 30+10+90+10 = 140120 → 30+10+120+10 = 1707) Рекомендации по реализации (чтобы не было багов)Всегда проверять худший случай: использовать slot_end как arrival_latest.Разделять:“окна прибытия” (то, что видит клиент)“занятость мастера” (то, что блокирует календарь)При создании заказа делать “мягкую бронь” (hold) на 5–10 минут, чтобы избежать гонок при одновременных оплатах.Хранить arrival_fact отдельно: когда мастер подтвердил выезд, можно зафиксировать точное прибытие для аналитики, но расчёты доступности всё равно должны быть устойчивыми.Пример формирования слотовПараметры: Travel=30, Pre=10, Post=10. Заказы:Заказ A: прибытие 08:30–09:00, массаж 60 (ИТОГО 30+10+60+10=110)Заказ №1: прибытие 10:00–10:30, массаж 60 (ИТОГО 110)Заказ №2: прибытие 12:00–12:30, массаж 60 (ИТОГО 110)Заказ №3: прибытие 16:00–16:30, массаж 120 (ИТОГО 30+10+120+10=170)Заказ №4: прибытие 22:00–22:30, массаж 60 (ИТОГО 110) — чтобы “последний слот был в 22:00” СлотСтатусЗаказ / что происходит / что можно поставить08:00–08:30ЗанятTravel на Заказ A: 08:00–08:3008:30–09:00Поступил заказЗаказ A — массаж 60 мин (ИТОГО: 30+10+60+10=110)09:00–09:30ЗанятЗаказ A: Massage09:30–10:00ЗанятЗаказ A: Massage+Post + Travel к 10:0010:00–10:30Поступил заказЗаказ №1 — массаж 60 мин (ИТОГО: 110)10:30–11:00ЗанятЗаказ №1: Massage11:00–11:30ЗанятЗаказ №1: Massage11:30–12:00ЗанятЗаказ №1: Post + Travel к 12:0012:00–12:30Поступил заказЗаказ №2 — массаж 60 мин (ИТОГО: 110)12:30–13:00ЗанятЗаказ №2: Massage13:00–13:30ЗанятЗаказ №2: Massage+Post13:30–14:00СвободенМожно принять: только если без переезда (мастер уже на месте). Тогда: 60 или 90 мин (ИТОГО: 110/140). С переездом нельзя, т.к. Travel 30 “съест” этот слот.14:00–14:30СвободенМожно принять: 60 мин (ИТОГО: 110). 90/120 — не успеет к следующему заказу в 16:00–16:30.14:30–15:00Свободен но нельзяНельзя принять (с переездом): даже 60 мин не помещается с учётом Pre+Post+Travel до следующего заказа.15:00–15:30Свободен но нельзяНельзя принять: не помещается до следующего заказа (16:00–16:30).15:30–16:00ЗанятTravel к Заказу №3 (частично внутри слота)16:00–16:30Поступил заказЗаказ №3 — массаж 120 мин (ИТОГО: 30+10+120+10=170)16:30–17:00ЗанятЗаказ №3: Massage17:00–17:30ЗанятЗаказ №3: Massage17:30–18:00ЗанятЗаказ №3: Massage18:00–18:30ЗанятЗаказ №3: Massage+Post18:30–19:00СвободенМожно принять: только если без переезда (мастер уже на месте). Тогда: 60/90/120 (ИТОГО: 110/140/170). С переездом — лучше начинать с 19:00.19:00–19:30СвободенМожно принять: 60/90/120 (ИТОГО: 110/140/170).19:30–20:00СвободенМожно принять: 60 или 90 (ИТОГО: 110/140). 120 — не успеет к слоту 22:00–22:30.20:00–20:30СвободенМожно принять: только 60 (ИТОГО: 110).20:30–21:00Свободен но нельзяНельзя принять (с переездом): не помещается до слота 22:00–22:30.21:00–21:30Свободен но нельзяНельзя принять: не помещается до слота 22:00–22:30.21:30–22:00ЗанятTravel к 22:00 (частично внутри слота)22:00–22:30Поступил заказЗаказ №4 — массаж 60 мин (ИТОГО: 30+10+60+10=110)22:30–23:00ЗанятЗаказ №4: Massage23:00–23:30ЗанятЗаказ №4: Massage+Post23:30–00:00СвободенМожно принять, если политика смены позволяет уходить после полуночи: 60/90/120 (ИТОГО: 110/140/170). (Напр., 60 мин при прибытии 23:30 закончится: Massage до 00:40, Post до 00:50.)


=== file_30---59634638-21fd-4d6c-bd5b-5850e62731c6.docx ===
ТЗ: Экран выбора услуги, мастера и слота прибытия для выездного массажа(с учётом вида массажа, силы, длительности и количества клиентов)0) Модель работы в голове пользователя и принцип 3 шаговКлиент не выбирает “когда начнётся массаж”. Клиент выбирает окно прибытия мастера (arrival window) с шагом 30 минут (например, 10:00–10:30) и параметры услуги. Система показывает только те окна прибытия, куда заказ реально помещается в расписание мастера с учётом:TRAVEL — дорога к клиентуPRE — подготовка на месте (1 раз на визит)MASSAGE — фактическое время массажа (зависит от длительности и количества людей)INTER_CLIENT_BUFFER — пауза между клиентами (если 2+ человека подряд)POST — завершение/сборы после визита (1 раз на визит)дорога к следующему заказу, если он существует0.1. Навигационная логика: 3 шага — Услуга → Мастер и время → ОплатаUI реализуется как 3-шаговый сценарий (Stepper / Wizard), в котором каждый шаг решает одну задачу и передаёт результат в следующий:Услуга — пользователь выбирает что именно он заказывает: вид массажа + сила + длительность на человека + количество людей → формируется объект serviceParams, который определяет требования к мастеру и расчёт времени визита.Мастер и время — пользователь выбирает кто и когда может приехать: мастер (или “Все мастера”) + дата + доступные окна прибытия → на этом шаге система рассчитывает доступность и показывает только валидные окна прибытия.Оплата — пользователь подтверждает заказ и оплачивает: итоговая сумма + выбор Payme/Click + обязательное принятие оферты → чекбокс оферты расположен только на шаге оплаты; без него оплата невозможна.Критическое правило UX: пользователь не должен видеть занятые или невозможные слоты. Он видит только то, что можно выбрать прямо сейчас.1) Цели1.1. Бизнес-цельСнизить ошибки бронирования и срывы графика за счёт того, что клиенту показываются только валидные комбинации “услуга + мастер + время”.1.2. UX-цельСделать выбор быстрым и естественным:клиент выбирает параметры услуги,система автоматически фильтрует мастеров и слоты,если на выбранный слот подходит 1 мастер — выбор мастера делается автоматически.1.3. Техническая цельЕдиная формализованная логика доступности:по навыку (тип массажа),по силе,по длительности,по количеству людей,по расписанию и заказам мастера.2) Основные сущности и параметры2.1. Константы (v1.0)SLOT_STEP = 30 мин — шаг окон прибытияTRAVEL = 30 мин — переезд (фиксированный в v1.0)PRE = 10 мин — подготовка на месте (1 раз на визит)POST = 10 мин — сборы после визита (1 раз на визит)INTER_CLIENT_BUFFER = 10 мин — пауза между людьми при 2+ (настраиваемый параметр)PRE/POST — включают процедуры: стол, гигиена, материалы, упаковка, перезагрузка и т.д.2.2. Параметры услуги (выбирает клиент на шаге “Услуга”)massage_type — Relax / Traditional Thai (расширяемо)pressure_level — Soft / Medium / Hard / Anyduration_per_person — 60 / 90 / 120people_count — 1 / 2 / 3 / 4 (один визит, один адрес)2.3. Профиль мастера (для фильтрации и UI-карточки)Обязательные поля:supported_massage_types[]supported_pressure_levels[] (пример: {Medium, Hard} или {Soft, Medium})shift_start, shift_end по днямкарточка UI: фото, имя, рейтинг/отзывы, краткое описаниеПримечание (обязательное): даже если на старте “все мастера умеют всё”, capabilities должны храниться и использоваться в фильтрации (иначе при расширении услуг появится хаос).3) Расчёт длительности визита при 2–4 людях3.1. ПринципPRE выполняется один раз перед первым клиентомPOST выполняется один раз после последнегомассаж идёт последовательномежду клиентами добавляется INTER_CLIENT_BUFFER3.2. ФормулаПусть:D = duration_per_personN = people_countB = INTER_CLIENT_BUFFERТогда:massage_total = D*N + B*(N-1)visit_core = PRE + massage_total + POSTTOTAL_BUSY = TRAVEL + visit_core (для отображения и аналитики)Примеры:2×60: massage_total=130, TOTAL_BUSY=30+10+130+10=1803×90: massage_total=290, TOTAL_BUSY=30+10+290+10=3404) UI/UX: структура и поведение 3 шагов4.1. Общие требования к Stepperотображается в шапке под логотипом: Услуга → Мастер и время → Оплатасостояния: Done/Active/Todoпереход назад сохраняет введённые параметры4.2. Шаг 1 — УслугаЦель: собрать все параметры, влияющие на расчёт слотов и доступность мастеров.UI-элементы:Tabs: Relax | Thai | ...Chips силы: Soft | Medium | Hard | AnyДлительность: 60 | 90 | 120Кол-во людей: 1 | 2 | 3 | 4Действия:кнопка Далее → переход на шаг 2Результат:сформирован serviceParams = {massage_type, pressure_level, duration_per_person, people_count}4.3. Шаг 2 — Мастер и время (один экран)Цель: выбрать мастера и окно прибытия, исходя из serviceParams.UI-блоки:Сводка услуги (compact card) + Изменить (возврат на шаг 1)Карусель мастеровпервый элемент: “Все мастера / Автоподбор”далее карточки мастеровЛента дат (Сегодня/Завтра/…)Плитки доступных слотов прибытияпоказывать только доступныезанятые/невозможные не показыватьПамятка перед визитом (3 пункта)Sticky footer на шаге 2:сумма “Итого”кнопка Далее к оплатеоферты/чекбокса здесь нетПоведение “Все мастера”:отображаются слоты, где существует хотя бы один мастер, который:поддерживает massage_type,соответствует pressure_level (или Any),помещается по механике слотов (раздел 6)при выборе слота: фильтруются мастера под слот; если 1 — выбирается автоматически.4.4. Шаг 3 — ОплатаЦель: юридическое согласие и оплата.UI-элементы:детали заказа (услуга/люди/мастер/дата/окно прибытия)суммаPayme / Clickчекбокс Я принимаю условия оферты (обязательный)кнопка Оплатить активна только при отмеченном чекбоксе5) Пересчёт доступности (когда пересчитываем)Изменение любого параметра:massage_type / pressure_level / duration_per_person / people_count (шаг 1 → влияет на шаг 2)date (шаг 2)therapist (all/конкретный, шаг 2)→ приводит к пересчёту:доступных слотов,списка доступных мастеров (для режима “Все мастера”).Если выбранный ранее слот стал недоступен — сбрасываем выбор слота и показываем понятное сообщение.6) Механизм расчёта доступных слотов (arrival windows)6.1. Worst-case прибытияДля окна W=[Wstart, Wend]:arrival_latest = Wend (мастер может приехать в конце окна)6.2. Длительность визита с учётом N людейmassage_total = D*N + B*(N-1)visit_core = PRE + massage_total + POST6.3. Проверка “после предыдущего заказа”prev_ready_to_leave = prev_service_end + POSTусловие: prev_ready_to_leave + TRAVEL &lt;= arrival_latest6.4. Проверка “до следующего заказа”next_arrival_latest = next_window_endусловие: arrival_latest + visit_core + TRAVEL &lt;= next_arrival_latest6.5. Если следующего заказа нет (конец смены)условие: arrival_latest + visit_core &lt;= shift_end7) Админка: заполнение профиля мастера (минимум)фото, имя, описаниеsupported types/pressureграфик смен(опционально) теги и специализацииПравило силы: если мастер не поддерживает Soft — он не показывается при выборе Soft. Если Any — фильтр силы не применяется.8) Крайние случаи (обязательное поведение)Нет слотов на дату → показываем “Нет доступных слотов” + предлагаем “Завтра”0 мастеров под параметры → “Нет мастеров под выбранный тип/силу”Конфликт из-за изменения параметров → сброс слота + уведомление


=== file_31---7a4a246b-613f-404a-8368-56513cc009cc.docx ===
ТЗ: UI/UX экрана бронирования (выездной массаж SABAI)Картинка концепт не использовать как обязательное!!0) Вводная (как это должно работать)Пользователь бронирует не “время начала массажа”, а окно прибытия мастера (arrival window) шагом 30 минут (например, 10:00–10:30). Система показывает только доступные окна прибытия, где заказ реально помещается по времени с учётом дороги и буферов.Экран бронирования построен как 3-шаговый мастер (Stepper):Услуга → 2) Мастер и время → 3) ОплатаПользователь проходит путь быстро и без перегруза:все параметры услуги выбираются на шаге 1,мастер и слот выбираются на шаге 2 (на одном экране),оферта и Payme/Click — на шаге 3.1) Цели и принципы1.1 ЦелиПоказать пользователю только валидные варианты “кто + когда может приехать”.Упростить принятие решения: сначала “что хочу”, потом “кто и когда”, затем “оплата”.Минимизировать ошибки бронирования и конфликтные пересечения графика мастера.1.2 Принципы UXНе показывать занятые слоты (вообще).Все фильтры влияют на доступность: вид массажа, сила, длительность, кол-во людей, дата, мастер.Оферта/чекбокс — только на шаге оплаты, не в футтере шага 2.На шаге 2 мастер и время в одном экране, потому что время зависит от мастера.2) Этапы (Stepper) — обязательные требования2.1 Визуальный Stepper в шапкеПод логотипом SABAI отображается Stepper на 3 шага:УслугаМастер и времяОплатаСостояния:Done — выполненный шаг (галочка)Active — текущий шаг (подсветка)Todo — будущий шаг (серый)Поведение:Переход только вперёд по кнопке “Далее”.Назад — по кнопке “Назад” или кликом по предыдущему шагу (если включено).При возврате данные сохраняются.3) Шаг 0 (до Stepper): бесшовный входПользователь к шагу 1 уже должен быть “внутри”:ввод телефона → OTP → имя Требование: этот процесс должен быть максимально коротким и не ощущаться как отдельный “шаг бронирования”.(UI этого шага можно реализовать отдельным экраном/модалкой; в данной спецификации важно лишь, что дальше пользователь идентифицирован.)4) Шаг 1 — “Услуга” (всё, что влияет на расчёт)4.1 Состав полей (обязательные)Вид массажа (massage_type)Relax / Traditional Thai (расширяемо)Сила (pressure_level)Soft / Medium / Hard / AnyДлительность на человека (duration_per_person)60 / 90 / 120Количество людей (people_count)1 / 2 / 3 / 44.2 ПравилаЗначение Any по силе означает “любая сила” (фильтр по силе не применяется).После выбора параметров пользователь нажимает “Далее” → шаг 2.Валидация: все поля обязательны (можно ставить дефолты: например, Thai + Medium + 60 + 1).4.3 Результат шага 1Фиксируется объект serviceParams:massage_typepressure_levelduration_per_personpeople_count5) Шаг 2 — “Мастер и время” (на одном экране)5.1 Блоки экрана (обязательные)A) Сводка выбранной услуги (compact card)отображает выбранные параметрыкнопка “Изменить” возвращает на шаг 1B) Выбор мастера (карусель)первый элемент: “Все мастера / Автоподбор”далее карточки мастеров:фото, имя, рейтинг/отзывыподдерживаемая сила (например “Soft/Medium”)C) Выбор датыгоризонтальная лента дат на 7–14 дней:Сегодня, Завтра, далее днидаты без слотов: показывать “нет слотов” (или disable)D) Выбор слота прибытияплитки 30-мин окон, например 12:00–12:30показывать только доступные окназанятые/невозможные слоты не показыватьE) Памятка перед визитом (mini card, 3 пункта)тихая комната, без проходаместо 2×2 м для стола + розеткапротивопоказания сообщить заранееF) Нижняя фиксированная зона (sticky)сумма (Итого)кнопка “Далее к оплате”оферта/чекбокс здесь НЕ показывается5.2 Логика фильтрации (ключевая)Режим “Все мастера”Слоты показываются, если существует хотя бы один мастер, который:умеет massage_type,подходит по pressure_level (или Any),помещается во времени по правилам расписания (см. раздел 8).Опционально на слоте: доступно мастеров: N.Режим “Конкретный мастер”Слоты показываются только для выбранного мастера и текущих serviceParams.Умное поведение: слот → фильтр мастеровЕсли выбран “Все мастера” и пользователь нажал слот:система фильтрует мастеров и оставляет только подходящихесли подходящий мастер один — выбирается автоматически5.3 Переход к шагу 3Кнопка “Далее к оплате” активна только если:выбран слот прибытиявыбран мастер (или автоподобран)6) Шаг 3 — “Оплата”6.1 Обязательные элементыПодробности заказа (услуга, мастер, дата, окно прибытия)Сумма итогоСпособы оплаты:PaymeClickЧекбокс:“Я принимаю условия оферты” (обязателен)Кнопка “Оплатить”неактивна, пока не отмечен чекбокс оферты6.2 ПоведениеПри успешной оплате — экран подтверждения заказа + “Памятка” (можно расширенная).7) Данные мастера (требования к админке, чтобы UI работал)7.1 Обязательные поля профиля мастерафото, имя, краткое описаниерейтинг/кол-во отзывов (если есть)supported_massage_types[]supported_pressure_levels[] (например: Soft+Medium или Medium+Hard)график работы: shift_start, shift_end (по дням)(опционально) статусы: доступен/в отпуске7.2 Правило силы (важно)Если мастер не поддерживает Soft — он не должен появляться при выборе Soft. Рекомендуется хранить диапазон/набор уровней, а не одно значение.8) Рекомендации/изменения к механизму бронирования слотов (чтобы UI не показывал невозможное)8.1 Константы (v1.0)SLOT_STEP = 30 minTRAVEL = 30 minPRE = 10 minPOST = 10 minINTER_CLIENT_BUFFER = 10 min8.2 Влияние количества людей (обязательно учесть)Если D = duration_per_person, N = people_count, B = INTER_CLIENT_BUFFER:massage_total = D*N + B*(N-1)visit_core = PRE + massage_total + POSTTOTAL_BUSY = TRAVEL + visit_core (для отображения)8.3 Worst-case проверка окнаДля окна W=[Wstart, Wend] используем:arrival_latest = Wend (если помещается при позднем прибытии — значит слот точно валиден)8.4 Условия стыковкиПосле предыдущего заказа:prev_ready_to_leave + TRAVEL &lt;= arrival_latestДо следующего заказа:arrival_latest + visit_core + TRAVEL &lt;= next_arrival_latestЕсли следующего нет:arrival_latest + visit_core &lt;= shift_end9) Состояния и события UI (для фронтенда)9.1 State-модель (минимум)selectedStep = 1|2|3serviceParams = {type, pressure, durationPerPerson, peopleCount}selectedTherapistId = null | &quot;all&quot; | idselectedDateselectedSlot = {start, end}availableSlots[]availableTherapists[] (после фильтрации)9.2 СобытияonChangeServiceParams → пересчитать доступность (слоты/мастера)onChangeDate → пересчитать слоты, сбросить слот если выбранonChangeTherapist → пересчитать слотыonSelectSlot:если therapist=all → фильтруем мастеровиначе → фиксируем слот10) API рекомендации (чтобы всё работало быстро)getAvailableSlots(date, serviceParams, therapistId|null) → список слотов + (опционально) availableTherapistsCountgetAvailableTherapists(date, slot, serviceParams) → список подходящих мастеров(желательно) getDateAvailability(dateRange, serviceParams, therapistId|null) → чтобы быстро подсвечивать даты “есть/нет слотов”11) Acceptance Criteria (критерии приёмки)На шаге 2 пользователь никогда не видит занятые слоты.Смена вида/силы/длительности/людей пересчитывает доступность корректно.При выборе “Все мастера” и тапе по слоту мастера фильтруются, авто-выбор работает.Оферта и чекбокс присутствуют только на шаге 3, без чекбокса оплатить нельзя.Памятка перед визитом отображается на шаге 2 (минимум 3 пункта).Итоговая сумма отображается на шагах 2 и 3, обновляется при смене параметров.


